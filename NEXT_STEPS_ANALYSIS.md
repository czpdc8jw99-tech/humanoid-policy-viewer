# ä¸‹ä¸€æ­¥æ€è·¯åˆ†æž

## ðŸ” å½“å‰é—®é¢˜æ€»ç»“

### å·²å®Œæˆçš„ä¿®å¤
1. âœ… **å‘½ä»¤ä¼ é€’é—®é¢˜**ï¼š`_updateGamepadCommand()` ä¸å†é‡ç½®æµ‹è¯•å‘½ä»¤
2. âœ… **å¼ºåˆ¶å¯¹ç§°åŒ–**ï¼šå·¦å³è…¿åŠ¨ä½œå–å¹³å‡
3. âœ… **å‚æ•°è°ƒæ•´**ï¼š`action_scale=0.45`, `action_clip=2.0`

### ä»ç„¶å­˜åœ¨çš„é—®é¢˜
- âŒ **æœºå™¨äººç«™ä¸èµ·æ¥**ï¼šé›¶å‘½ä»¤æ—¶ç­–ç•¥è¾“å‡ºä¸ç¨³å®šï¼Œå¯¼è‡´æœºå™¨äººå€’ä¸‹
- âŒ **ç­–ç•¥è¾“å‡ºä¸å¯¹ç§°**ï¼šå³ä½¿æœ‰å¼ºåˆ¶å¯¹ç§°åŒ–ï¼Œç­–ç•¥æœ¬èº«è¾“å‡ºå°±ä¸å¯¹ç§°

---

## ðŸŽ¯ å…³é”®å‘çŽ°

### Trackingç­–ç•¥ vs Locoç­–ç•¥çš„åŒºåˆ«

| ç‰¹æ€§ | Trackingç­–ç•¥ | Locoç­–ç•¥ |
|------|-------------|----------|
| **æ˜¯å¦æœ‰trackingé…ç½®** | âœ… æœ‰ | âŒ æ—  |
| **æ˜¯å¦æœ‰Commandè§‚å¯Ÿ** | âŒ æ—  | âœ… æœ‰ |
| **ç«™ç«‹ç¨³å®šæ€§** | âœ… ç¨³å®šï¼ˆä½¿ç”¨default motionï¼‰ | âŒ ä¸ç¨³å®šï¼ˆç›´æŽ¥ä½¿ç”¨ç­–ç•¥è¾“å‡ºï¼‰ |
| **å·¥ä½œåŽŸç†** | ä½¿ç”¨TrackingHelperï¼Œè·Ÿè¸ªmotions.jsonä¸­çš„åŠ¨ä½œ | ç›´æŽ¥ä½¿ç”¨ç­–ç•¥è¾“å‡º |

### ä¸ºä»€ä¹ˆTrackingç­–ç•¥èƒ½ç¨³å®šç«™ç«‹ï¼Ÿ
- Trackingç­–ç•¥ä½¿ç”¨ `TrackingHelper`
- æœ‰ `motions.json` ä¸­çš„ `default` motion
- `default` motion æ˜¯ä¸€ä¸ªç¨³å®šçš„ç«™ç«‹å§¿æ€åºåˆ—
- ç­–ç•¥è·Ÿè¸ªè¿™ä¸ªåºåˆ—ï¼Œè€Œä¸æ˜¯ç›´æŽ¥è¾“å‡ºåŠ¨ä½œ

### ä¸ºä»€ä¹ˆLocoç­–ç•¥ç«™ä¸èµ·æ¥ï¼Ÿ
- Locoç­–ç•¥ç›´æŽ¥ä½¿ç”¨ç­–ç•¥è¾“å‡º
- ç­–ç•¥æ˜¯ä¸ºè¡Œèµ°è®¾è®¡çš„ï¼Œä¸æ˜¯ä¸ºç«™ç«‹è®¾è®¡çš„
- é›¶å‘½ä»¤æ—¶ç­–ç•¥è¾“å‡ºä¸ç¨³å®šï¼ˆå³ä½¿å¯¹ç§°åŒ–åŽï¼‰

---

## ðŸ’¡ è§£å†³æ–¹æ¡ˆæ€è·¯

### æ–¹æ¡ˆ1ï¼šåªé’ˆå¯¹Locoç­–ç•¥ï¼Œé›¶å‘½ä»¤æ—¶ä½¿ç”¨default_joint_posï¼ˆæŽ¨èï¼‰

**æ€è·¯**ï¼š
- é€šè¿‡æ£€æŸ¥æ˜¯å¦æœ‰ `Command` è§‚å¯Ÿæ¨¡å—æ¥åˆ¤æ–­æ˜¯å¦æ˜¯locoç­–ç•¥
- å¦‚æžœæ˜¯locoç­–ç•¥ä¸”å‘½ä»¤ä¸ºé›¶ï¼Œä½¿ç”¨ `default_joint_pos` è€Œä¸æ˜¯ç­–ç•¥è¾“å‡º
- è¿™æ ·ä¸ä¼šå½±å“trackingç­–ç•¥ï¼ˆtrackingç­–ç•¥æ²¡æœ‰Commandè§‚å¯Ÿæ¨¡å—ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… åªå½±å“locoç­–ç•¥ï¼Œä¸å½±å“å…¶ä»–ç­–ç•¥
- âœ… ä¸ä¿®æ”¹åŽŸæœ¬çš„ä»£ç é€»è¾‘ï¼ˆåœ¨step()æ–¹æ³•ä¸­æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼‰
- âœ… ç®€å•ç›´æŽ¥

**å®žçŽ°ä½ç½®**ï¼š
- `src/simulation/policyRunner.js` çš„ `step()` æ–¹æ³•
- åœ¨ç­–ç•¥æŽ¨ç†ä¹‹å‰æ·»åŠ æ£€æŸ¥

**ä»£ç é€»è¾‘**ï¼š
```javascript
// æ£€æŸ¥æ˜¯å¦æ˜¯locoç­–ç•¥ï¼ˆæœ‰Commandè§‚å¯Ÿæ¨¡å—ï¼‰
const hasCommandObs = this.obsModules.some(obs => obs.constructor.name === 'Command');

if (hasCommandObs) {
  // è¿™æ˜¯locoç­–ç•¥
  const cmdMagnitude = Math.sqrt(
    this.command[0]**2 + 
    this.command[1]**2 + 
    this.command[2]**2
  );
  
  if (cmdMagnitude < 0.01) {
    // é›¶å‘½ä»¤ï¼šä½¿ç”¨default_joint_pos
    const target = new Float32Array(this.numActions);
    for (let i = 0; i < this.numActions; i++) {
      target[i] = this.defaultJointPos[i];
    }
    this.lastActions.fill(0.0);
    // æ›´æ–°PrevActions
    for (const obs of this.obsModules) {
      if (obs.constructor.name === 'PrevActions' && typeof obs.update === 'function') {
        obs.update(state);
      }
    }
    return target;
  }
}

// éžlocoç­–ç•¥æˆ–éžé›¶å‘½ä»¤ï¼šæ­£å¸¸ä½¿ç”¨ç­–ç•¥è¾“å‡º
// ... åŽŸæœ‰çš„ç­–ç•¥æŽ¨ç†é€»è¾‘
```

---

### æ–¹æ¡ˆ2ï¼šè°ƒæ•´default_joint_posä½¿å…¶æ›´é€‚åˆç«™ç«‹

**æ€è·¯**ï¼š
- æ£€æŸ¥å½“å‰çš„ `default_joint_pos` æ˜¯å¦åˆç†
- å¯¹æ¯”trackingç­–ç•¥çš„ `default_joint_pos`
- è°ƒæ•´locoç­–ç•¥çš„ `default_joint_pos` ä½¿å…¶æ›´ç¨³å®š

**å¯¹æ¯”**ï¼š
- Trackingç­–ç•¥çš„ `default_joint_pos`ï¼š
  - hip_pitch: -0.28, -0.28
  - knee: 0.5, 0.5
  - ankle_pitch: -0.23, -0.23
  
- Locoç­–ç•¥çš„ `default_joint_pos`ï¼š
  - hip_pitch: -0.2, -0.2
  - knee: 0.42, 0.42
  - ankle_pitch: -0.23, -0.23

**å¯èƒ½çš„é—®é¢˜**ï¼š
- Locoç­–ç•¥çš„kneeè§’åº¦è¾ƒå°ï¼ˆ0.42 vs 0.5ï¼‰
- å¯èƒ½éœ€è¦è°ƒæ•´ä½¿å…¶æ›´æŽ¥è¿‘trackingç­–ç•¥

**ä¼˜ç‚¹**ï¼š
- âœ… åªä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œä¸ä¿®æ”¹ä»£ç 
- âœ… ä¸å½±å“å…¶ä»–ç­–ç•¥

**ç¼ºç‚¹**ï¼š
- âš ï¸ å¦‚æžœç­–ç•¥è¾“å‡ºæœ¬èº«ä¸ç¨³å®šï¼Œè°ƒæ•´default_joint_poså¯èƒ½ä¸å¤Ÿ

---

### æ–¹æ¡ˆ3ï¼šå¢žå¼ºPDå¢žç›Šï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰

**æ€è·¯**ï¼š
- å¢žåŠ stiffnesså’Œdampingï¼Œè®©æœºå™¨äººæ›´ç¨³å®š
- ç‰¹åˆ«æ˜¯è…¿éƒ¨å…³èŠ‚çš„PDå¢žç›Š

**ä¼˜ç‚¹**ï¼š
- âœ… åªä¿®æ”¹é…ç½®æ–‡ä»¶
- âœ… ç®€å•

**ç¼ºç‚¹**ï¼š
- âš ï¸ å¯èƒ½å½±å“è¡Œèµ°æ—¶çš„å“åº”æ€§
- âš ï¸ åªæ˜¯ä¸´æ—¶æ–¹æ¡ˆï¼Œä¸èƒ½æ ¹æœ¬è§£å†³é—®é¢˜

---

## ðŸŽ¯ æŽ¨èæ–¹æ¡ˆ

### ä¼˜å…ˆé¡ºåº

1. **æ–¹æ¡ˆ1**ï¼šåªé’ˆå¯¹locoç­–ç•¥ï¼Œé›¶å‘½ä»¤æ—¶ä½¿ç”¨default_joint_pos
   - æœ€ç›´æŽ¥æœ‰æ•ˆ
   - ä¸å½±å“å…¶ä»–ç­–ç•¥
   - ä¸ä¿®æ”¹åŽŸæœ¬çš„ä»£ç é€»è¾‘ï¼ˆåªæ˜¯æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼‰

2. **æ–¹æ¡ˆ2**ï¼šè°ƒæ•´default_joint_pos
   - ä½œä¸ºè¾…åŠ©æ–¹æ¡ˆ
   - å¦‚æžœæ–¹æ¡ˆ1è¿˜ä¸å¤Ÿç¨³å®šï¼Œå¯ä»¥å°è¯•

3. **æ–¹æ¡ˆ3**ï¼šå¢žå¼ºPDå¢žç›Š
   - æœ€åŽè€ƒè™‘
   - å¦‚æžœå‰ä¸¤ä¸ªæ–¹æ¡ˆéƒ½ä¸å¤Ÿï¼Œå¯ä»¥å°è¯•

---

## ðŸ“‹ å®žæ–½æ­¥éª¤

### æ­¥éª¤1ï¼šå®žæ–½æ–¹æ¡ˆ1
1. åœ¨ `policyRunner.js` çš„ `step()` æ–¹æ³•å¼€å§‹å¤„æ·»åŠ æ£€æŸ¥
2. æ£€æŸ¥æ˜¯å¦æœ‰Commandè§‚å¯Ÿæ¨¡å—
3. å¦‚æžœæœ‰ä¸”å‘½ä»¤ä¸ºé›¶ï¼Œè¿”å›ždefault_joint_pos
4. å¦åˆ™æ­£å¸¸ä½¿ç”¨ç­–ç•¥è¾“å‡º

### æ­¥éª¤2ï¼šæµ‹è¯•éªŒè¯
1. æµ‹è¯•locoç­–ç•¥ï¼šé›¶å‘½ä»¤æ—¶åº”è¯¥ç¨³å®šç«™ç«‹
2. æµ‹è¯•locoç­–ç•¥ï¼šéžé›¶å‘½ä»¤æ—¶åº”è¯¥æ­£å¸¸è¡Œèµ°
3. æµ‹è¯•trackingç­–ç•¥ï¼šç¡®ä¿ä¸å—å½±å“

### æ­¥éª¤3ï¼šå¦‚æžœè¿˜ä¸å¤Ÿç¨³å®š
1. å°è¯•æ–¹æ¡ˆ2ï¼šè°ƒæ•´default_joint_pos
2. æˆ–è€…å°è¯•æ–¹æ¡ˆ3ï¼šå¢žå¼ºPDå¢žç›Š

---

## ðŸ” éœ€è¦ç¡®è®¤çš„é—®é¢˜

1. **default_joint_posæ˜¯å¦æ­£ç¡®è®¾ç½®ï¼Ÿ**
   - å½“å‰locoç­–ç•¥çš„default_joint_posæ˜¯å¦åˆç†ï¼Ÿ
   - æ˜¯å¦éœ€è¦è°ƒæ•´ï¼Ÿ

2. **åˆå§‹çŠ¶æ€æ˜¯å¦æ­£ç¡®ï¼Ÿ**
   - æœºå™¨äººåˆå§‹ä½ç½®æ˜¯å¦æ­£ç¡®ï¼ˆqpos[2] = 0.8ï¼‰ï¼Ÿ
   - åˆå§‹å…³èŠ‚ä½ç½®æ˜¯å¦æ­£ç¡®è®¾ç½®ï¼Ÿ

3. **ç­–ç•¥è¾“å‡ºæ˜¯å¦çœŸçš„ä¸ç¨³å®šï¼Ÿ**
   - å³ä½¿æœ‰å¼ºåˆ¶å¯¹ç§°åŒ–ï¼Œç­–ç•¥è¾“å‡ºæ˜¯å¦ä»ç„¶å¯¼è‡´ä¸ç¨³å®šï¼Ÿ
   - éœ€è¦è¿›ä¸€æ­¥æµ‹è¯•éªŒè¯

---

## ðŸ’­ æˆ‘çš„å»ºè®®

**å…ˆå®žæ–½æ–¹æ¡ˆ1**ï¼š
- è¿™æ˜¯æœ€ç›´æŽ¥æœ‰æ•ˆçš„æ–¹æ¡ˆ
- åªå½±å“locoç­–ç•¥ï¼Œä¸å½±å“å…¶ä»–ç­–ç•¥
- ä¸ä¿®æ”¹åŽŸæœ¬çš„ä»£ç é€»è¾‘ï¼ˆåªæ˜¯æ·»åŠ æ¡ä»¶åˆ¤æ–­ï¼‰

**å¦‚æžœæ–¹æ¡ˆ1è¿˜ä¸å¤Ÿç¨³å®š**ï¼š
- å†è€ƒè™‘æ–¹æ¡ˆ2ï¼ˆè°ƒæ•´default_joint_posï¼‰
- æˆ–è€…æ–¹æ¡ˆ3ï¼ˆå¢žå¼ºPDå¢žç›Šï¼‰

**å…³é”®ç‚¹**ï¼š
- å¿…é¡»ç¡®ä¿åªé’ˆå¯¹locoç­–ç•¥ï¼ˆé€šè¿‡æ£€æŸ¥Commandè§‚å¯Ÿæ¨¡å—ï¼‰
- ä¸èƒ½å½±å“trackingç­–ç•¥
- ä¸èƒ½ä¿®æ”¹åŽŸæœ¬çš„ä»£ç é€»è¾‘

---

## â“ éœ€è¦ä½ ç¡®è®¤

1. è¿™ä¸ªæ€è·¯æ˜¯å¦åˆç†ï¼Ÿ
2. æ˜¯å¦åŒæ„å…ˆå®žæ–½æ–¹æ¡ˆ1ï¼Ÿ
3. å¦‚æžœæ–¹æ¡ˆ1è¿˜ä¸å¤Ÿç¨³å®šï¼Œæ˜¯å¦åŒæ„å°è¯•æ–¹æ¡ˆ2æˆ–3ï¼Ÿ
