# 自动诊断功能说明

## ✅ 已实现的功能

我已经修改了代码，**策略加载完成后会自动运行诊断**，此时模拟处于暂停状态，机器人还没有开始运动。

---

## 工作原理

1. **策略加载时自动暂停**：策略加载时，模拟会自动设置为暂停状态（`paused = true`）
2. **初始化完成后自动诊断**：策略初始化完成后，会自动运行诊断函数
3. **诊断结果输出到控制台**：所有诊断结果都会显示在控制台，带有 ✅/❌ 标记

---

## 使用方法

### 步骤1：刷新页面
按 `F5` 刷新页面

### 步骤2：加载策略
选择 **"G1 Locomotion (Gamepad)"** 策略

### 步骤3：查看自动诊断结果
策略加载完成后，控制台会自动显示诊断结果，格式如下：

```
=== [自动诊断] 策略初始化完成，开始诊断 ===
[自动诊断] ProjectedGravityB: { value: [...], magnitude: ..., status: ✅/❌ }
[自动诊断] RootAngVelB: { value: [...], magnitude: ..., status: ✅/❌ }
[自动诊断] Command: { value: [...], magnitude: ..., status: ✅/❌ }
[自动诊断] JointPosRel: { values: [...], maxAbs: ..., status: ✅/❌ }
[自动诊断] JointVel: { values: [...], maxAbs: ..., status: ✅/❌ }
[自动诊断] Root Position Z: { value: ..., expected: 0.8, status: ✅/❌ }
[自动诊断] Action Symmetry: { leftLegAvg: ..., rightLegAvg: ..., symmetryRatio: ..., status: ✅/❌ }
=== [自动诊断] 完成 ===
```

---

## 诊断项目说明

### 1. ProjectedGravityB（重力方向）
- **预期值**：`[0, 0, -1]`
- **检查**：重力方向是否正确（机器人站立时）
- **✅ 正常**：差异 < 0.1
- **❌ 异常**：差异 ≥ 0.1

### 2. RootAngVelB（根角速度）
- **预期值**：`[0, 0, 0]`
- **检查**：机器人是否在旋转
- **✅ 正常**：大小 < 0.01
- **❌ 异常**：大小 ≥ 0.01

### 3. Command（命令）
- **预期值**：`[0, 0, 0]`
- **检查**：速度命令是否为零
- **✅ 正常**：大小 < 0.01
- **❌ 异常**：大小 ≥ 0.01

### 4. JointPosRel（关节位置相对值）
- **预期值**：`[0, 0, 0, 0, 0, 0]`（初始时）
- **检查**：关节位置是否在默认位置
- **✅ 正常**：最大绝对值 < 0.01
- **❌ 异常**：最大绝对值 ≥ 0.01

### 5. JointVel（关节速度）
- **预期值**：`[0, 0, 0, 0, 0, 0]`
- **检查**：关节是否在运动
- **✅ 正常**：最大绝对值 < 0.01
- **❌ 异常**：最大绝对值 ≥ 0.01

### 6. Root Position Z（根位置高度）
- **预期值**：`0.8`
- **检查**：机器人是否在正确的高度
- **✅ 正常**：值 = 0.8
- **❌ 异常**：值 ≠ 0.8
- **⚠️ 警告**：如果值 < 0.5，机器人可能已倒下

### 7. Action Symmetry（动作对称性）
- **检查**：左右腿动作是否对称
- **✅ 正常**：对称性比例 > 0.7
- **❌ 异常**：对称性比例 ≤ 0.7
- **⚠️ 警告**：如果比例 < 0.7，动作严重不对称

---

## 优势

1. ✅ **自动运行**：无需手动操作，策略加载后自动诊断
2. ✅ **时机正确**：在模拟暂停时运行，机器人还未开始运动
3. ✅ **结果清晰**：每个项目都有 ✅/❌ 标记，一目了然
4. ✅ **不依赖类名**：使用索引查找模块，即使类名被压缩也能工作

---

## 如果诊断失败

如果某个诊断项显示 ❌，请：

1. **查看具体数值**：检查实际值与预期值的差异
2. **查看警告信息**：如果有 ⚠️ 标记，注意警告内容
3. **截图诊断结果**：把诊断结果发给我，我会帮你分析

---

## 示例输出

```
=== [自动诊断] 策略初始化完成，开始诊断 ===
[自动诊断] ProjectedGravityB: {
  value: ['0.0000', '0.0000', '-1.0000'],
  magnitude: '1.0000',
  expected: '[0, 0, -1]',
  difference: '0.0000',
  status: '✅'
}
[自动诊断] RootAngVelB: {
  value: ['0.0000', '0.0000', '0.0000'],
  magnitude: '0.0000',
  expected: '[0, 0, 0]',
  status: '✅'
}
[自动诊断] Command: {
  value: ['0.0000', '0.0000', '0.0000'],
  magnitude: '0.0000',
  expected: '[0, 0, 0]',
  status: '✅'
}
[自动诊断] JointPosRel: {
  values: ['0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000'],
  maxAbs: '0.0000',
  expected: '[0, 0, 0, 0, 0, 0]',
  status: '✅'
}
[自动诊断] JointVel: {
  values: ['0.0000', '0.0000', '0.0000', '0.0000', '0.0000', '0.0000'],
  maxAbs: '0.0000',
  expected: '[0, 0, 0, 0, 0, 0]',
  status: '✅'
}
[自动诊断] Root Position Z: {
  value: '0.800',
  expected: 0.8,
  status: '✅',
  note: ''
}
[自动诊断] Action Symmetry: {
  leftLegAvg: '0.1234',
  rightLegAvg: '0.1456',
  symmetryRatio: '0.8476',
  status: '✅',
  note: ''
}
=== [自动诊断] 完成 ===
```

---

## 下一步

1. **刷新页面**（F5）
2. **加载策略**（选择 "G1 Locomotion (Gamepad)"）
3. **查看控制台**：自动诊断结果会自动显示
4. **报告结果**：把诊断结果发给我，特别是显示 ❌ 的项目
