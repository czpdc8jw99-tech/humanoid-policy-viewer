# å…³é”®é—®é¢˜åˆ†æï¼šå·¦å³è…¿ä¸å¹³è¡¡

## é—®é¢˜ç°è±¡
- **å·¦è…¿å¤ªè½¯**ï¼šæ ¹æœ¬ç«‹ä¸ä½
- **å³è…¿å¤ªç¡¬**ï¼šå³ä½¿è¾“å…¥è¿åŠ¨æŒ‡ä»¤ä¹Ÿå®Œå…¨ä¸åŠ¨

## å‘ç°çš„ä¸‰ä¸ªå…³é”®é—®é¢˜

### ğŸ”´ é—®é¢˜1ï¼šPDå¢ç›Šæ²¡æœ‰é‡æ–°æ’åºï¼ˆæœ€ä¸¥é‡ï¼‰

**Pythonä»£ç **ï¼š
```python
# LocoMode.py enter() æ–¹æ³•
self.kps_reorder[motor_idx] = self.kps[i]  # é‡æ–°æ’åº
self.kds_reorder[motor_idx] = self.kds[i]

# run() æ–¹æ³•è¾“å‡º
self.policy_output.kps = self.kps_reorder.copy()  # ä½¿ç”¨é‡æ–°æ’åºåçš„
self.policy_output.kds = self.kds_reorder.copy()
```

**å½“å‰JSä»£ç **ï¼š
```javascript
// main.js line 987-988
const kp = this.kpPolicy ? this.kpPolicy[i] : 0.0;  // âŒ ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰é‡æ–°æ’åºï¼
const kd = this.kdPolicy ? this.kdPolicy[i] : 0.0;
```

**å½±å“**ï¼š
- PDå¢ç›Šåº”ç”¨åˆ°é”™è¯¯çš„å…³èŠ‚ï¼
- ä¾‹å¦‚ï¼šå·¦è…¿çš„kpå¯èƒ½åº”ç”¨åˆ°å³è…¿ï¼Œå¯¼è‡´å·¦å³è…¿åˆšåº¦å®Œå…¨ä¸åŒ
- **è¿™æ˜¯å¯¼è‡´å·¦å³è…¿ä¸å¹³è¡¡çš„æ ¹æœ¬åŸå› ï¼**

### ğŸ”´ é—®é¢˜2ï¼šåŠ¨ä½œé‡æ–°æ’åºé€»è¾‘é”™è¯¯

**Pythonä»£ç **ï¼š
```python
# LocoMode.py run() æ–¹æ³•
action_reorder = loco_action.copy()
for i in range(len(self.joint2motor_idx)):
    motor_idx = self.joint2motor_idx[i]
    action_reorder[motor_idx] = loco_action[i]  # ç­–ç•¥ç´¢å¼•i -> ç”µæœºç´¢å¼•motor_idx
```

**å½“å‰JSä»£ç **ï¼š
```javascript
// main.js line 955-977
for (let i = 0; i < this.numActions; i++) {
  const motorIdx = this.joint2motorIdx[i];
  // âŒ é”™è¯¯ï¼šè¯•å›¾é€šè¿‡ ctrl_adr_policy æŸ¥æ‰¾
  for (let j = 0; j < this.numActions; j++) {
    if (this.ctrl_adr_policy[j] === motorIdx) {  // motorIdxæ˜¯ç”µæœºç´¢å¼•ï¼Œä¸æ˜¯actuatorç´¢å¼•ï¼
      // ...
    }
  }
}
```

**é—®é¢˜**ï¼š
- `joint2motor_idx[i]` æ˜¯ç”µæœºç´¢å¼•ï¼ˆ0-28ï¼‰
- `ctrl_adr_policy[j]` æ˜¯MuJoCo actuatorç´¢å¼•ï¼ˆå¯èƒ½ä¸æ˜¯0-28ï¼‰
- **ä¸¤è€…ä¸åŒ¹é…ï¼**

### ğŸ”´ é—®é¢˜3ï¼šè¯»å–çŠ¶æ€çš„é€»è¾‘é”™è¯¯

**å½“å‰JSä»£ç **ï¼š
```javascript
// main.js line 1195-1199
for (let j = 0; j < this.numActions; j++) {
  if (this.ctrl_adr_policy[j] === motorIdx) {  // âŒ åŒæ ·çš„é”™è¯¯
    qposAdr = this.qpos_adr_policy[j];
    break;
  }
}
```

**é—®é¢˜**ï¼š
- åŒæ ·çš„é”™è¯¯ï¼šç”µæœºç´¢å¼•å’Œactuatorç´¢å¼•ä¸åŒ¹é…
- å¯¼è‡´ä»é”™è¯¯çš„å…³èŠ‚è¯»å–çŠ¶æ€

---

## æ ¹æœ¬åŸå› åˆ†æ

### joint2motor_idx çš„çœŸæ­£å«ä¹‰

åœ¨Pythonä»£ç ä¸­ï¼š
- `self.qj` æ˜¯æŒ‰**ç”µæœºé¡ºåº**çš„æ•°ç»„ï¼ˆ29ä¸ªç”µæœºï¼Œç´¢å¼•0-28ï¼‰
- `joint2motor_idx[i]` è¡¨ç¤ºç­–ç•¥ç´¢å¼• `i` å¯¹åº”çš„ç”µæœºç´¢å¼•ï¼ˆ0-28ï¼‰
- é‡æ–°æ’åºåï¼ŒåŠ¨ä½œå’ŒPDå¢ç›Šéƒ½æŒ‰ç”µæœºé¡ºåºè¾“å‡º

ä½†åœ¨JSä»£ç ä¸­ï¼š
- æˆ‘ä»¬ä½¿ç”¨åç§°æ˜ å°„ï¼Œç›´æ¥æ˜ å°„åˆ°MuJoCoçš„actuator
- `ctrl_adr_policy[i]` æ˜¯ç­–ç•¥ç´¢å¼• `i` å¯¹åº”çš„MuJoCo actuatorç´¢å¼•
- **æ²¡æœ‰"ç”µæœºé¡ºåº"çš„æ¦‚å¿µ**

### å…³é”®ç†è§£

**å¯èƒ½çš„æƒ…å†µ**ï¼š
1. Pythonä»£ç ä¸­çš„"ç”µæœºé¡ºåº"å¯èƒ½å¯¹åº”JSä¸­çš„actuatoré¡ºåº
2. ä½† `joint2motor_idx` çš„å€¼ï¼ˆ0-28ï¼‰å¯èƒ½**ä¸æ˜¯** `ctrl_adr_policy` çš„å€¼
3. éœ€è¦éªŒè¯ï¼š`joint2motor_idx[i]` æ˜¯å¦ç­‰äºæŸä¸ª `j`ï¼Œä½¿å¾— `ctrl_adr_policy[j]` æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Ÿ

---

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šç¦ç”¨ joint2motor_idx é‡æ–°æ’åºï¼ˆæ¨èå…ˆè¯•è¿™ä¸ªï¼‰

**å‡è®¾**ï¼šJSä»£ç ä¸­çš„åç§°æ˜ å°„å·²ç»æ­£ç¡®ï¼Œä¸éœ€è¦ `joint2motor_idx` é‡æ–°æ’åº

**æ­¥éª¤**ï¼š
1. æš‚æ—¶ç¦ç”¨ `joint2motor_idx` çš„é‡æ–°æ’åºé€»è¾‘
2. ç›´æ¥ä½¿ç”¨åç§°æ˜ å°„çš„ç»“æœ
3. æµ‹è¯•æ˜¯å¦è§£å†³é—®é¢˜

### æ–¹æ¡ˆ2ï¼šæ­£ç¡®å®ç° joint2motor_idx é‡æ–°æ’åº

**éœ€è¦**ï¼š
1. ç†è§£ `joint2motor_idx` ä¸ `ctrl_adr_policy` çš„å…³ç³»
2. åˆ›å»ºæ­£ç¡®çš„é‡æ–°æ’åºé€»è¾‘
3. åŒæ—¶é‡æ–°æ’åº kp/kd

### æ–¹æ¡ˆ3ï¼šéªŒè¯æ˜ å°„å…³ç³»

**éœ€è¦æ£€æŸ¥**ï¼š
1. `joint2motor_idx` çš„å€¼æ˜¯å¦ç­‰äº `ctrl_adr_policy` çš„ç´¢å¼•ï¼Ÿ
2. æˆ–è€…éœ€è¦åˆ›å»ºåå‘æ˜ å°„ï¼Ÿ

---

## ç«‹å³éœ€è¦ä¿®å¤çš„ä¼˜å…ˆçº§

### ğŸ”´ æœ€é«˜ä¼˜å…ˆçº§ï¼šPDå¢ç›Šé‡æ–°æ’åº
- **å½±å“**ï¼šç›´æ¥å¯¼è‡´å·¦å³è…¿ä¸å¹³è¡¡
- **ä¿®å¤**ï¼šéœ€è¦é‡æ–°æ’åº `kpPolicy` å’Œ `kdPolicy`

### ğŸŸ¡ é«˜ä¼˜å…ˆçº§ï¼šåŠ¨ä½œé‡æ–°æ’åº
- **å½±å“**ï¼šåŠ¨ä½œåº”ç”¨åˆ°é”™è¯¯çš„å…³èŠ‚
- **ä¿®å¤**ï¼šéœ€è¦æ­£ç¡®å®ç° `joint2motor_idx` é‡æ–°æ’åº

### ğŸŸ¡ é«˜ä¼˜å…ˆçº§ï¼šçŠ¶æ€è¯»å–
- **å½±å“**ï¼šä»é”™è¯¯çš„å…³èŠ‚è¯»å–çŠ¶æ€
- **ä¿®å¤**ï¼šéœ€è¦æ­£ç¡®å®ç° `joint2motor_idx` é‡æ–°æ’åº

---

## å»ºè®®çš„è°ƒè¯•æ­¥éª¤

1. **å…ˆç¦ç”¨ joint2motor_idx é‡æ–°æ’åº**ï¼Œçœ‹çœ‹æ˜¯å¦è§£å†³é—®é¢˜
2. å¦‚æœè§£å†³äº†ï¼Œè¯´æ˜ `joint2motor_idx` çš„å®ç°æœ‰é—®é¢˜
3. å¦‚æœæ²¡è§£å†³ï¼Œæ£€æŸ¥å…¶ä»–å¯èƒ½çš„é—®é¢˜ï¼ˆå¦‚åˆå§‹çŠ¶æ€ã€å…³èŠ‚é¡ºåºç­‰ï¼‰
