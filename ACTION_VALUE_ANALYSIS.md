# 原始动作值分析报告

## 数据概览

### 第一组数据（较早状态/初始状态）

**左腿原始动作值**：
- left_hip_pitch: 0.425
- left_hip_roll: 0.019
- left_hip_yaw: 0.103
- left_knee: -0.129
- left_ankle_pitch: 0.176
- left_ankle_roll: 0.145

**右腿原始动作值**：
- right_hip_pitch: 0.393
- right_hip_roll: -0.012
- right_hip_yaw: -0.109
- right_knee: -0.207
- right_ankle_pitch: 0.223
- right_ankle_roll: -0.138

**对称性分析（第一组）**：
- hip_pitch: 0.425 vs 0.393（差异：0.032）✓ 相对对称
- hip_roll: 0.019 vs -0.012（差异：0.031）✓ 相对对称
- hip_yaw: 0.103 vs -0.109（差异：0.212）⚠️ 有一定差异
- knee: -0.129 vs -0.207（差异：0.078）✓ 相对对称
- ankle_pitch: 0.176 vs 0.223（差异：0.047）✓ 相对对称
- ankle_roll: 0.145 vs -0.138（差异：0.283）⚠️ 有一定差异

**结论**：第一组数据左右腿相对对称，差异较小。

---

### 第二组数据（当前状态/问题状态）

**左腿原始动作值**：
- left_hip_pitch: -0.088
- left_hip_roll: 1.203
- left_hip_yaw: -0.129
- left_knee: -1.807
- left_ankle_pitch: -1.355
- left_ankle_roll: 0.523

**右腿原始动作值**：
- right_hip_pitch: 0.866
- right_hip_roll: -0.415
- right_hip_yaw: 0.068
- right_knee: -0.939
- right_ankle_pitch: 1.648
- right_ankle_roll: -1.631

**对称性分析（第二组）**：
- hip_pitch: -0.088 vs 0.866（差异：0.954）❌ **严重不对称**
- hip_roll: 1.203 vs -0.415（差异：1.618）❌ **严重不对称**
- hip_yaw: -0.129 vs 0.068（差异：0.197）⚠️ 有一定差异
- knee: -1.807 vs -0.939（差异：0.868）❌ **严重不对称**
- ankle_pitch: -1.355 vs 1.648（差异：3.003）❌ **严重不对称**
- ankle_roll: 0.523 vs -1.631（差异：2.154）❌ **严重不对称**

**结论**：第二组数据左右腿**严重不对称**，差异非常大。

---

## 关键发现

### 1. 状态变化导致不对称

- **第一组**：左右腿相对对称（差异 < 0.3）
- **第二组**：左右腿严重不对称（差异 > 0.8，最大 3.0）

这说明：
- 策略在初始状态下输出相对对称
- 但随着仿真进行，左右腿动作逐渐变得不对称
- **问题可能是累积的**：每一步的不对称导致下一步更不对称

### 2. 最严重的不对称关节

按差异大小排序：
1. **ankle_pitch**: 差异 3.003（最严重）
2. **ankle_roll**: 差异 2.154
3. **hip_roll**: 差异 1.618
4. **knee**: 差异 0.868
5. **hip_pitch**: 差异 0.954

### 3. 可能的原因

#### 原因 A：观察向量不对称（最可能）

如果左右腿的关节位置/速度不同，策略会输出不同的动作。

**需要检查**：
- 左右腿的关节位置（JointPosRel）是否对称
- 左右腿的关节速度（JointVel）是否对称
- 左右腿的前一步动作（PrevActions）是否对称

#### 原因 B：机器人初始状态不对称

如果机器人初始时左右腿位置不同，会导致后续动作不对称。

**需要检查**：
- 机器人初始关节位置是否对称
- 默认关节位置（default_joint_pos）是否正确应用

#### 原因 C：策略模型本身的问题

策略模型可能没有学习到对称性约束。

**可能性**：较低（因为第一组数据相对对称）

---

## 下一步诊断

### 1. 检查观察向量（最重要）

查看新添加的 `[Observation Debug]` 日志，检查：
- 左右腿的关节位置（JointPosRel）是否对称
- 左右腿的关节速度（JointVel）是否对称
- 左右腿的前一步动作（PrevActions）是否对称

### 2. 检查机器人初始状态

- 检查机器人初始关节位置
- 检查 default_joint_pos 是否正确应用

### 3. 检查动作应用

- 确认动作是否正确应用到对应的关节
- 确认左右腿的 PD 参数是否对称

---

## 预期结果

如果观察向量对称，但动作值不对称：
- **问题在策略模型**：模型没有学习到对称性

如果观察向量不对称：
- **问题在状态读取或初始化**：需要检查关节位置/速度的读取逻辑
