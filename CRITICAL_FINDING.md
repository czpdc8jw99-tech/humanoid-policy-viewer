# 🔴 关键发现：问题根源已确认

## 📊 监控数据分析

### Frame 90（动作开始不对称）
- **JointPosRel**: ✅ 对称 (0.9373)
- **JointVel**: ✅ 对称 (0.7912)
- **PrevActions**: ❌ **不对称 (0.4918)** ← **关键！**
- **动作对称性**: ❌ 不对称 (0.2981)

### Frame 120（动作继续不对称）
- **JointPosRel**: ❌ 不对称 (0.6461) ← 开始不对称
- **JointVel**: ✅ 对称 (0.9608)
- **PrevActions**: ✅ 对称 (0.7001) ← 暂时恢复
- **动作对称性**: ❌ 不对称 (0.4800)

### Frame 150（动作严重不对称）
- **JointPosRel**: ❌ 不对称 (0.6529) ← 继续不对称
- **JointVel**: ✅ 对称 (0.8671)
- **PrevActions**: ❌ **不对称 (0.2447)** ← **严重不对称！**
- **动作对称性**: ❌ 不对称 (0.4373)

---

## 🎯 根本原因确认

### 问题链条

1. **Frame 90**: PrevActions 不对称 (0.4918) → 策略输出不对称 (0.2981)
2. **Frame 120**: JointPosRel 开始不对称 (0.6461) → 动作继续不对称 (0.4800)
3. **Frame 150**: PrevActions 严重不对称 (0.2447) → 动作严重不对称 (0.4373)

### 关键发现

**PrevActions 的不对称是问题的根源！**

- PrevActions 是前一步的动作值
- 如果前一步动作不对称，策略会基于这个不对称的输入产生更不对称的输出
- 形成**恶性循环**：不对称 → 更不对称 → 更更不对称

---

## 💡 为什么 PrevActions 会不对称？

### 可能的原因

1. **初始动作不对称**：
   - 策略在初始几帧可能就输出了不对称的动作
   - 这些不对称的动作被存储到 PrevActions 中
   - 导致后续策略输入不对称

2. **PrevActions 更新时机问题**：
   - PrevActions 可能在动作应用之前就更新了
   - 或者更新了错误的动作值

3. **策略模型本身的问题**：
   - 策略在初始状态下就输出不对称的动作
   - 即使观察向量对称，策略也可能输出不对称

---

## 🔧 解决方案

### 方案1：检查 PrevActions 的更新时机（优先）

**问题**：PrevActions 应该在什么时候更新？

**当前逻辑**：
- `PrevActions.update()` 在 `PolicyRunner.step()` 中调用
- 应该在动作应用**之后**更新，使用**实际应用的动作值**

**需要检查**：
- `PrevActions.update()` 的调用时机
- 是否使用了正确的动作值（应用后的值，而不是策略原始输出）

### 方案2：强制 PrevActions 对称（临时修复）

**方法**：
- 在更新 PrevActions 时，强制左右腿对称
- 例如：使用左右腿的平均值

**风险**：
- 可能会掩盖真正的问题
- 不是根本解决方案

### 方案3：检查策略初始输出（根本修复）

**方法**：
- 检查策略在初始状态下（观察向量完全对称）是否输出对称的动作
- 如果初始输出就不对称，说明策略模型本身有问题

---

## 📋 下一步行动

### 立即检查：PrevActions 的更新逻辑

1. **检查 `PrevActions.update()` 的调用时机**
2. **检查使用的动作值是否正确**
3. **检查是否在动作应用之后更新**

### 如果 PrevActions 更新逻辑正确

→ 说明策略在初始状态下就输出不对称的动作
→ 需要检查策略模型本身或 LSTM 状态初始化

---

## 🎯 关键结论

1. ✅ **观察向量检查成功**：成功定位到问题根源
2. 🔴 **PrevActions 不对称是问题根源**：Frame 90 就不对称，导致后续恶性循环
3. ⚠️ **需要检查 PrevActions 更新逻辑**：确保使用正确的动作值，在正确的时机更新

---

## 📊 数据总结

| Frame | PrevActions 对称性 | 动作对称性 | 关系 |
|-------|-------------------|-----------|------|
| 90 | ❌ 0.4918 | ❌ 0.2981 | PrevActions 不对称 → 动作不对称 |
| 120 | ✅ 0.7001 | ❌ 0.4800 | JointPosRel 不对称 → 动作不对称 |
| 150 | ❌ 0.2447 | ❌ 0.4373 | PrevActions 严重不对称 → 动作严重不对称 |

**结论**：PrevActions 的不对称是导致动作不对称的根本原因。
