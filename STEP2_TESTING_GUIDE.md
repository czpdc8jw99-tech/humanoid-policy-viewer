# 步骤2测试指南：验证策略响应

## 🎯 目标

使用新添加的测试命令UI，验证策略在接收到非零命令时是否输出不同的动作，并测试机器人是否能够行走。

---

## ✅ 已添加的功能（v9.0.31）

### UI 测试控件

当选择 "G1 Locomotion (Gamepad)" 策略时，会显示：

1. **三个输入框**：
   - **Vx**（前进速度）：范围 [-0.4, 0.7]
   - **Vy**（侧向速度）：范围 [-0.4, 0.4]
   - **Wz**（转向速度）：范围 [-1.57, 1.57]

2. **四个快捷按钮**：
   - **Stop**：设置命令为 [0.0, 0.0, 0.0]
   - **Forward**：设置命令为 [0.3, 0.0, 0.0]（前进）
   - **Turn L**：设置命令为 [0.0, 0.0, 0.5]（左转）
   - **Turn R**：设置命令为 [0.0, 0.0, -0.5]（右转）

3. **当前命令显示**：
   - 显示当前设置的命令值：`vx=X.XX, vy=Y.YY, wz=Z.ZZ`

### 功能说明

- ✅ **自动应用**：当输入框值改变时，自动应用到策略
- ✅ **优先级**：如果手柄已连接，手柄命令优先；否则使用测试命令
- ✅ **实时更新**：命令值实时传递到策略

---

## 📋 详细测试步骤

### 步骤2.1：加载策略并确认UI

1. **打开网页**：
   - 访问：https://czpdc8jw99-tech.github.io/humanoid-policy-viewer/
   - 等待页面加载完成

2. **选择策略**：
   - 在策略下拉菜单中选择 **"G1 Locomotion (Gamepad)"**
   - 等待策略加载完成（看到 "Policy initialized" 日志）

3. **确认测试控件显示**：
   - 应该看到 "Test Commands" 部分
   - 应该看到三个输入框（Vx, Vy, Wz）
   - 应该看到四个按钮（Stop, Forward, Turn L, Turn R）
   - 应该看到当前命令显示

**✅ 验证**：如果看到测试控件，说明UI添加成功。

---

### 步骤2.2：测试零命令（停止状态）

1. **设置零命令**：
   - 点击 **"Stop"** 按钮
   - 确认输入框显示：Vx=0.0, Vy=0.0, Wz=0.0
   - 确认当前命令显示：`vx=0.00, vy=0.00, wz=0.00`

2. **启动模拟**：
   - 点击播放按钮（▶️）启动模拟
   - 观察机器人行为

3. **观察和记录**：
   - **机器人行为**：
     - 机器人是否能够稳定站立？
     - 机器人是否向后倒？
     - 机器人是否左右腿动作不对称？
   
   - **控制台监控**（可选）：
     - 打开浏览器控制台（F12）
     - 查看 `[动作监控]` 输出
     - 记录动作对称性比例
     - 记录最大动作值

4. **预期结果**：
   - ⚠️ **可能无法稳定站立**（这是预期的，因为策略是为行走设计的）
   - ⚠️ **动作可能不对称**（这也是预期的）

**📝 记录**：记录机器人在零命令下的行为表现。

---

### 步骤2.3：测试前进命令

1. **设置前进命令**：
   - 点击 **"Forward"** 按钮
   - 确认输入框显示：Vx=0.3, Vy=0.0, Wz=0.0
   - 确认当前命令显示：`vx=0.30, vy=0.00, wz=0.00`

2. **启动模拟**（如果还没启动）：
   - 点击播放按钮启动模拟

3. **观察和记录**：
   - **机器人行为**：
     - 机器人是否尝试向前移动？
     - 机器人是否能够保持平衡？
     - 机器人是否能够行走？
     - 机器人是否向后倒？
   
   - **控制台监控**（可选）：
     - 查看 `[动作监控]` 输出
     - 记录动作对称性比例（多步平均）
     - 记录最大动作值
     - 对比零命令时的动作值

4. **预期结果**：
   - ✅ **机器人应该尝试向前移动**
   - ✅ **动作值应该与零命令时不同**
   - ⚠️ **可能仍然无法完全稳定**（需要进一步优化）

**📝 记录**：记录机器人在前进命令下的行为表现。

---

### 步骤2.4：测试不同速度

1. **测试低速前进**：
   - 手动设置 Vx=0.1, Vy=0.0, Wz=0.0
   - 观察机器人行为
   - 记录：机器人是否移动？速度如何？

2. **测试中速前进**：
   - 手动设置 Vx=0.3, Vy=0.0, Wz=0.0
   - 观察机器人行为
   - 记录：机器人是否移动？速度如何？

3. **测试高速前进**：
   - 手动设置 Vx=0.5, Vy=0.0, Wz=0.0
   - 观察机器人行为
   - 记录：机器人是否移动？速度如何？是否稳定？

4. **对比结果**：
   - 不同速度下机器人行为是否不同？
   - 速度越快，动作幅度是否越大？
   - 哪个速度最稳定？

**📝 记录**：记录不同速度下的行为表现。

---

### 步骤2.5：测试转向命令

1. **测试左转**：
   - 点击 **"Turn L"** 按钮
   - 或者手动设置 Vx=0.0, Vy=0.0, Wz=0.5
   - 观察机器人是否转向

2. **测试右转**：
   - 点击 **"Turn R"** 按钮
   - 或者手动设置 Vx=0.0, Vy=0.0, Wz=-0.5
   - 观察机器人是否转向

3. **测试前进+转向**：
   - 手动设置 Vx=0.3, Vy=0.0, Wz=0.5
   - 观察机器人是否同时前进和转向

**📝 记录**：记录转向命令下的行为表现。

---

## 🔍 验证方法

### 方法1：通过UI观察

- ✅ 观察机器人的行为
- ✅ 观察是否能够行走
- ✅ 观察是否能够保持平衡

### 方法2：通过控制台监控

**在浏览器控制台运行**：

```javascript
// 1. 检查当前命令
const demo = window.demo;
console.log('Demo command:', Array.from(demo.cmd));

// 2. 检查策略命令
const pr = demo.policyRunner || demo.policyRunners?.[0];
if (pr) {
  console.log('Policy command:', Array.from(pr.command));
  console.log('Last actions:', Array.from(pr.lastActions));
  
  // 3. 检查动作对称性
  const leftIndices = [0, 3, 6, 9, 13, 17];
  const rightIndices = [1, 4, 7, 10, 14, 18];
  const leftAvg = leftIndices.reduce((sum, i) => sum + Math.abs(pr.lastActions[i]), 0) / leftIndices.length;
  const rightAvg = rightIndices.reduce((sum, i) => sum + Math.abs(pr.lastActions[i]), 0) / rightIndices.length;
  const ratio = Math.min(leftAvg, rightAvg) / Math.max(leftAvg, rightAvg);
  console.log('Action symmetry:', {
    leftAvg: leftAvg.toFixed(4),
    rightAvg: rightAvg.toFixed(4),
    ratio: ratio.toFixed(4),
    status: ratio > 0.7 ? '✅ Symmetric' : '❌ Asymmetric'
  });
}
```

---

## ✅ 验证清单

完成步骤2后，应该确认：

- [ ] 测试控件正常显示和工作
- [ ] 命令值可以正常设置（通过输入框或按钮）
- [ ] 命令值正确传递到策略（控制台验证）
- [ ] 零命令时机器人行为（记录表现）
- [ ] 非零命令时机器人行为（记录表现）
- [ ] 不同命令值产生不同的行为
- [ ] 机器人是否能够行走（是/否）
- [ ] 机器人是否能够保持平衡（是/否）

---

## 📊 测试结果记录表

| 测试场景 | 命令值 | 机器人行为 | 动作对称性 | 备注 |
|---------|--------|-----------|-----------|------|
| 停止 | [0, 0, 0] | ? | ? |  |
| 前进（低速） | [0.1, 0, 0] | ? | ? |  |
| 前进（中速） | [0.3, 0, 0] | ? | ? |  |
| 前进（高速） | [0.5, 0, 0] | ? | ? |  |
| 左转 | [0, 0, 0.5] | ? | ? |  |
| 右转 | [0, 0, -0.5] | ? | ? |  |
| 前进+左转 | [0.3, 0, 0.5] | ? | ? |  |

**填写说明**：
- **机器人行为**：描述机器人做了什么（例如："向前移动"、"向后倒"、"无法移动"等）
- **动作对称性**：从控制台监控中获取（多步平均的对称性比例）
- **备注**：记录任何异常或观察到的现象

---

## 🔧 如果验证失败

### 问题1：测试控件不显示

**解决方法**：
- 确保选择了 "G1 Locomotion (Gamepad)" 策略
- 刷新页面
- 检查浏览器控制台是否有错误

### 问题2：命令值不生效

**解决方法**：
- 检查控制台中的命令值（运行验证方法2）
- 确认策略已加载
- 确认模拟已启动

### 问题3：机器人无法行走

**可能原因和解决方法**：
- **动作值过大** → 需要降低 `action_scale` 或 `action_clip`
- **动作不对称** → 需要强制对称化
- **策略参数不合适** → 需要调整参数

---

## 📝 下一步

完成步骤2后，根据测试结果决定：

### 如果机器人能够行走

→ ✅ **继续优化**（步骤3：手柄集成测试）

### 如果机器人无法行走

→ ⚠️ **进入步骤4：问题修复**
- 根据具体问题选择修复方案
- 可能需要强制对称化
- 可能需要调整策略参数

---

## 🎯 预期结果

### 理想状态

1. ✅ **机器人能够响应命令**：设置非零命令时，机器人尝试移动
2. ✅ **机器人能够行走**：设置前进命令时，机器人向前行走
3. ✅ **机器人能够保持平衡**：行走时能够保持平衡

### 可能的问题

1. ⚠️ **机器人无法稳定站立**：零命令时不稳定（这是预期的）
2. ⚠️ **行走时动作过大**：需要调整 action_scale 或 action_clip
3. ⚠️ **行走时仍然不对称**：需要强制对称化或调整参数

---

## 🚀 开始测试

1. **等待部署完成**（约 1-2 分钟）
2. **刷新页面**（F5）
3. **选择策略**："G1 Locomotion (Gamepad)"
4. **开始测试**：按照上述步骤逐一测试

完成后告诉我测试结果，我们根据结果决定下一步行动！
