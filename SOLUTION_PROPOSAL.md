# 解决方案提案

## 🔴 问题确认

根据监控数据，**PrevActions 的不对称是问题的根源**：

- Frame 90: PrevActions 不对称 (0.4918) → 动作不对称 (0.2981)
- Frame 150: PrevActions 严重不对称 (0.2447) → 动作严重不对称 (0.4373)

## 💡 根本原因

**恶性循环**：
1. 策略在初始几帧输出不对称的动作
2. 这些不对称的动作被存储到 PrevActions
3. 下一帧策略基于不对称的 PrevActions 输入，输出更不对称的动作
4. 循环加剧，最终导致机器人失去平衡

## 🔧 解决方案

### 方案1：早期检测和干预（已实现）

**已添加**：
- 监控前 10 帧的动作对称性
- 监控前 10 帧的 PrevActions 对称性
- 当检测到不对称时立即警告

**目的**：
- 确定动作何时开始不对称
- 确定 PrevActions 何时开始不对称
- 帮助定位问题的起始点

### 方案2：强制 PrevActions 对称（临时修复）

**方法**：
- 在更新 PrevActions 时，如果检测到严重不对称，强制对称化
- 例如：使用左右腿的平均值

**实现**：
```javascript
// 在 PrevActions.update() 中
if (prevRatio < 0.7) {
  // 强制对称：使用左右腿的平均值
  const avgAction = (leftAvg + rightAvg) / 2;
  // 更新 PrevActions 使用对称值
}
```

**风险**：
- 可能会掩盖真正的问题
- 不是根本解决方案
- 可能会影响策略的正常学习

### 方案3：检查策略初始输出（根本修复）

**方法**：
- 检查策略在初始状态下（观察向量完全对称）是否输出对称的动作
- 如果初始输出就不对称，说明策略模型本身有问题

**验证**：
- 查看早期检测的输出
- 如果 Frame 1-3 就出现不对称，说明策略模型有问题

### 方案4：降低 action_clip（临时修复）

**当前**：`action_clip: 100.0`
**建议**：降低到 `5.0` 或 `3.0`

**目的**：
- 防止异常大的动作值（如 10.3132）被应用到机器人
- 限制动作范围，减少不对称的放大效应

**风险**：
- 可能会限制正常动作的范围
- 不是根本解决方案

---

## 📋 下一步行动

### 立即执行
1. **等待部署完成**（约 1-2 分钟）
2. **刷新页面**（F5）
3. **加载策略并启动模拟**
4. **查看早期检测输出**：
   - Frame 1-10 的动作对称性
   - Frame 1-10 的 PrevActions 对称性
   - 确定动作何时开始不对称

### 根据早期检测结果决定

#### 如果 Frame 1-3 就出现不对称
→ 说明策略模型本身有问题
→ 需要检查策略模型或 LSTM 状态初始化

#### 如果 Frame 4-10 开始不对称
→ 说明策略在初始几帧后开始不稳定
→ 可能需要调整策略参数或 action_scale

#### 如果 Frame 10+ 才开始不对称
→ 说明策略在运行一段时间后开始不稳定
→ 可能需要检查观察向量的更新或物理模拟的稳定性

---

## 🎯 关键结论

1. ✅ **问题根源已确认**：PrevActions 的不对称导致恶性循环
2. ✅ **早期检测已实现**：可以确定动作何时开始不对称
3. ⏳ **等待早期检测结果**：根据结果决定下一步行动

---

## 📊 预期结果

### 如果早期检测显示 Frame 1-3 就不对称
→ 需要检查策略模型或 LSTM 状态初始化

### 如果早期检测显示 Frame 4-10 开始不对称
→ 需要调整策略参数或 action_scale

### 如果早期检测显示 Frame 10+ 才开始不对称
→ 需要检查观察向量的更新或物理模拟的稳定性
