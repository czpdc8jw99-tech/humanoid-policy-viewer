# 数据分析报告

## 📊 用户提供的数据

### 原始动作对称性
- **leftRawAvg**: 0.3404
- **rightRawAvg**: 1.2724
- **rawRatio**: 0.2675（严重不对称）
- **结论**: ❌ 策略输出本身就不对称

### 观察向量检查

#### JointPosRel 对称性
- **leftAvg**: 0.0000
- **rightAvg**: 0.0000
- **ratio**: NaN
- **status**: ❌ 不对称（错误！应该是 ✅ 对称）

#### JointVel 对称性
- **leftAvg**: 0.0000
- **rightAvg**: 0.0000
- **ratio**: NaN
- **status**: ❌ 不对称（错误！应该是 ✅ 对称）

#### PrevActions 对称性
- **leftAvg**: 0.0000
- **rightAvg**: 0.0000
- **ratio**: NaN
- **status**: ❌ 不对称（错误！应该是 ✅ 对称）

---

## 🔍 问题分析

### 问题1：NaN 和错误的状态标记

**原因**：
- 当 leftAvg 和 rightAvg 都是 0 时，`Math.min(0, 0) / Math.max(0, 0)` = `0/0` = `NaN`
- 代码检查 `NaN > 0.7` 返回 `false`，所以错误地标记为"❌ 不对称"
- 但实际上，如果都是 0，应该标记为"✅ 对称"（初始状态）

**修复**：
- 添加特殊处理：当 leftAvg === 0 && rightAvg === 0 时，ratio = 1.0，status = '✅ 对称'

### 问题2：数据异常

**观察**：
- 原始动作严重不对称（0.2675）
- 但观察向量都是 0

**可能的原因**：
1. **这是初始状态（Frame 1-10）**
   - 观察向量都是 0（初始状态）
   - 但策略已经输出了不对称的动作
   - 说明策略在初始状态下就输出不对称的动作

2. **观察向量计算有问题**
   - 可能 `readPolicyState()` 返回的状态不正确
   - 或者观察向量的计算逻辑有问题

3. **这是 warmup 阶段**
   - 如果这是 warmup 阶段的输出，观察向量都是 0 是正常的
   - 但 warmup 阶段不应该输出不对称的动作

---

## 💡 关键发现

### 发现1：策略在初始状态下就输出不对称的动作

**证据**：
- 原始动作对称性：leftRawAvg: 0.3404, rightRawAvg: 1.2724, rawRatio: 0.2675
- 观察向量都是 0（初始状态）
- 说明策略在初始状态下（观察向量全为 0）就输出不对称的动作

**结论**：
- **策略模型本身可能有问题**
- 或者 **LSTM 状态初始化有问题**

### 发现2：NaN 问题需要修复

**问题**：
- 当观察向量都是 0 时，ratio 会是 NaN
- 代码错误地标记为"❌ 不对称"

**修复**：
- 已修复：添加特殊处理，当都是 0 时，标记为"✅ 对称（初始状态）"

---

## 🔧 已实施的修复

### 修复1：NaN 问题

**修改**：
- JointPosRel、JointVel、PrevActions 的对称性检查都添加了特殊处理
- 当 leftAvg === 0 && rightAvg === 0 时：
  - ratio = 1.0
  - status = '✅ 对称'
  - note = '初始状态（值全为0）'

**效果**：
- 正确标记初始状态为"✅ 对称"
- 避免 NaN 导致的错误判断

---

## 📋 下一步行动

### 立即行动
1. **部署修复后的代码**
   - 修复 NaN 问题
   - 正确标记初始状态

2. **重新测试**
   - 查看修复后的输出
   - 确认初始状态是否正确标记为"✅ 对称"

### 进一步调查
1. **检查策略初始输出**
   - 为什么策略在初始状态下（观察向量全为 0）就输出不对称的动作？
   - 是策略模型的问题？
   - 还是 LSTM 状态初始化的问题？

2. **检查 LSTM warmup**
   - warmup 是否充分？
   - LSTM 状态是否正确初始化？

3. **检查策略模型**
   - 策略模型本身是否有问题？
   - 是否需要重新训练？

---

## 🎯 关键结论

1. ✅ **NaN 问题已修复**：正确标记初始状态为"✅ 对称"
2. 🔴 **策略在初始状态下就输出不对称的动作**：这是问题的根源
3. ⏳ **需要进一步调查**：为什么策略在初始状态下就输出不对称的动作？

---

## 📊 数据总结

| 项目 | 值 | 状态 |
|------|-----|------|
| 原始动作 leftRawAvg | 0.3404 | - |
| 原始动作 rightRawAvg | 1.2724 | - |
| 原始动作 rawRatio | 0.2675 | ❌ 严重不对称 |
| JointPosRel leftAvg | 0.0000 | ✅ 初始状态 |
| JointPosRel rightAvg | 0.0000 | ✅ 初始状态 |
| JointVel leftAvg | 0.0000 | ✅ 初始状态 |
| JointVel rightAvg | 0.0000 | ✅ 初始状态 |
| PrevActions leftAvg | 0.0000 | ✅ 初始状态 |
| PrevActions rightAvg | 0.0000 | ✅ 初始状态 |

**关键发现**：策略在初始状态下（观察向量全为 0）就输出不对称的动作（rawRatio: 0.2675）。
